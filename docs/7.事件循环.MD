# 1. 事件循环基础

## 1.1 什么是事件循环

事件循环（Event Loop）是 JavaScript 实现异步编程的核心机制，它使得 JavaScript 能够在单线程环境下高效处理并发操作。事件，用户交互，脚本，渲染，网络这些都是我们所熟悉的东西，他们都是由 event loop 协调的。触发一个 click 事件，进行一次 ajax 请求，背后都有 event loop 在运作。

事件循环主要由调用栈（Call Stack）、堆（Heap）和任务队列（Task Queue）组成。调用栈用于存放所有的同步任务；堆用于存储对象，是内存分配的地方；而任务队列则用于存放异步任务的回调函数，分为宏任务队列和微任务队列。

## 1.2 事件循环解决了什么

JavaScript 是一门单线程语言，这意味着它在同一时间只能执行一个任务。这种设计最初是为了简化 DOM 操作和浏览器交互，避免多线程环境下可能出现的复杂同步问题。

然而，单线程模型面临一个明显的问题：如何处理耗时操作而不阻塞整个程序？这就是事件循环发挥作用的地方。

想象一下繁忙餐厅里的一位服务员（JavaScript 的主线程）。这位服务员同一时刻只能做一件事，但需要同时应对多桌客人的需求：

1. **接待新客人**
2. **记录点餐**
3. **将订单交给厨房**
4. **上菜**
5. **结账**

如果这位服务员在等待厨房做菜时就站在原地不动，那整个餐厅就会陷入瘫痪。聪明的服务员会怎么做？

- 将订单交给厨房后，不会站在那里等待
- 而是拿一个小铃铛
- 告诉厨房："菜做好了就摇铃铛叫我"
- 然后去服务其他客人
- 听到铃声后再去取餐

这就是事件循环的核心思想：**不等待，不阻塞**。主线程将耗时任务交给其他系统处理，自己继续执行后续工作，等到结果返回时再通过回调函数处理。

下面的代码展示了这一过程：

```javascript
console.log("服务员开始工作");

function greetNewCustomer() {
  console.log("欢迎光临，请问需要点什么？");
}

setTimeout(() => {
  console.log("厨房通知：菜品已准备好，请上菜");
}, 2000);

greetNewCustomer();
console.log("记录客人的订单并送至厨房");
console.log("服务员去招呼其他客人了");

// 输出顺序：
// 服务员开始工作
// 欢迎光临，请问需要点什么？
// 记录客人的订单并送至厨房
// 服务员去招呼其他客人了
// (2秒后) 厨房通知：菜品已准备好，请上菜
```

在这个例子中，服务员（JavaScript 主线程）不会在厨房做菜的过程中闲置等待，而是去完成其他工作。当厨房完成订单后，通过回调函数通知服务员来取餐。

这种单线程+事件循环的模型为 JavaScript 提供了处理异步操作的能力，而不需要引入多线程的复杂性。

# 2. 浏览器的事件循环

## 2.1 执行栈与任务队列

## 2.2 宏任务和微任务

## 2.3 事件循环的执行流程

# 3. 最后
