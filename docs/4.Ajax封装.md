# 引言

本文旨在探讨如何将传统的 Ajax 请求封装为 Promise 形式。我们将从 XMLHttpRequest 基础知识入手，逐步实现一个功能完善的 Promise 化 Ajax 请求库。

> 本文会介绍 XMLHttpRequest，但它实际上是过时 Web 规范的产物，应该只在旧版本浏览器中使用。

# 1. XMLHttpRequest 基础

所有现代浏览器都通过 XMLHttpRequest 构造函数原生支持 XHR 对象：

let xhr = new XMLHttpRequest();

## 1.1 XMLHttpRequest 概述

### 1.1.1 使用 XHR

使用 XHR 对象首先要调用 open 方法，open 方法接受三个参数：请求的类型、请求的 URL、是否异步发送请求，然后必须要调用 send()方法发生定义好的请求，send 方法接收一个参数，是作为请求体，如果不需要请求体，则传 null，这个参数再某些浏览器是必须的，下面是一个例子：

```js
let xhr = new XMLHttpRequest();
xhr.open("GET", "http://example.com", true);
xhr.send(null);
```

因为这个请求时同步的，所以 javascript 代码会等待服务器响应后再继续执行，收到响应后，XHR 的对象的以下属性会被填充上数据：

- responseText：作为响应体返回的文本
- responseXML：如果响应的内容类型是 text/xml 或 application/xml，则保存响应的 XML 文档
- status：响应的 HTTP 状态码
- statusText：HTTP 状态的说明

### 1.1.2 HTTP 头部

### 1.1.3 GET 请求

### 1.1.4 POST 请求

### 1.1.5 XMLHttpRequest Level 2

1. FormData 类型

2. 超时

3. overrideMimeType()方法

## 1.2 传统 Ajax 的局限性

# 2. Promise 封装实现

## 2.1 设计思路

## 2.2 核心实现

## 2.3 功能增强

## 2.4 高级特性

## 2.5 完整代码与使用示例

# 总结与展望

随着前端技术的发展，Fetch API 和 axios 等工具已经成为主流的网络请求方案，但理解 XMLHttpRequest 的 Promise 封装过程，有助于我们更深入地理解 JavaScript 的异步编程模型。
